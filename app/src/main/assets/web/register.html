<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Customer Satisfaction Survey</title>

    <link rel="apple-touch-icon" href="apple-touch-icon.png">

    <link rel="stylesheet" href="/styles/main.css">

    <script src="/scripts/vendor/modernizr.js"></script>
    <script src="/scripts/sweetalert.min.js"></script>
    <link rel="stylesheet" href="/styles/sweetalert.css">
</head>
<body>
<img src="/images/header.png" class="header">

<div class="container">
    <form id="ajax_form">
        <input name="employee_id" type="hidden">
        <div class="box reg">
            <label for="card" class="card">
                <input type="file" name="card" id="card" accept="image/*" class="card__file" id="card" type>
                <img src="" width="100%" height="100%" class="card__img">
                <input type="hidden" name="card_base64">
            </label>

            <div class="form-group">
                <label class="reg__label">Name</label>
                <input name="name" type="text" class="reg__input form-control">
            </div>
            <div class="form-group">
                <label class="reg__label">Phone</label>
                <input name="telephone" type="text" class="reg__input form-control">
            </div>
            <div class="form-group">
                <label class="reg__label">E-mail</label>
                <input name="email" type="text" class="reg__input form-control">
            </div>

            <div class="submit">
                <a onclick="logout()" class="btn btn-sm cancel" type="button">Sign out</a>
                <button class="btn btn-sm pull-right" type="submit">Next</button>
            </div>
            <img src="/images/footer2.png" class="footer2">
        </div>
    </form>
</div>

<script src="/scripts/vendor.js"></script>

<script src="/scripts/plugins.js"></script>

<script src="/scripts/main.js"></script>

<script type="text/javascript" charset="utf-8">
    function logout(){
        window.localStorage.removeItem("employee_id");
        window.location.href = "/login.html";
    }
    $(function () {
        $("input[name='employee_id']").val(window.localStorage.getItem("employee_id"));
        if(window.localStorage.getItem("user_id")){
            window.location.href = "/add.html";
        }
        $("#ajax_form").submit(function () {
            swal({
                    title: "",
                    text: "Please confirm the information",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "Yes",
                    closeOnConfirm: false
                },
                function(){
                    var formData = {};
                    if($("input[name='name']").val()){
                        formData["name"] = $("input[name='name']").val();
                    }
                    if($("input[name='telephone']").val()){
                        formData["telephone"] = $("input[name='telephone']").val();
                    }
                    if($("input[name='email']").val()){
                        formData["email"] = $("input[name='email']").val();
                    }
                    // formData.append("card", document.getElementById("card").files[0]);
                    // formData.append("name", $("input[name='name']").val());
                    // formData.append("telephone", $("input[name='telephone']").val());
                    // formData.append("email", $("input[name='email']").val());
                    $.ajax({
                        type: 'POST',
                        url: '/register',
                        data: $("#ajax_form").serialize(),
                        dataType: "json",
                        success:function(data){
                            window.localStorage.setItem("user_id", data.user_id);
                            window.location.href = "/register.html";
                        },
                        error:function(XMLHttpRequest){
                            //请求出错处理
                            sweetAlert("", XMLHttpRequest.responseText, "error");
                        }
                    });
                });
            return false;
        });
    });

    $('#card').on('change', function (e) {
        $('.card__img').attr('src', '');
        var file = e.target.files[0];

        var reader = new FileReader();
        reader.readAsDataURL(file);

        reader.onload = function (e) {
            $('.card__img').attr('src', e.target.result);
            $("input[name='card_base64']").val(e.target.result);
        };
    });
</script>
</body>
</html>

